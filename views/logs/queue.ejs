<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <!-- Header de la Cola -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title mb-0">
                            <i class="fas fa-inbox me-2"></i>Cola de Correo de Postfix
                        </h5>
                    </div>
                    <div>
                        <span class="badge bg-<%= queue.count > 0 ? 'warning' : 'success' %> fs-6">
                            <i class="fas fa-<%= queue.count > 0 ? 'exclamation-triangle' : 'check-circle' %> me-1"></i>
                            <%= queue.count %> emails en cola
                        </span>
                    </div>
                </div>
                <div class="card-body">
                    <% if (queue.count> 0) { %>
                        <!-- Acciones Rápidas -->
                        <div class="row mb-4">
                            <div class="col-md-8">
                                <div class="alert alert-warning mb-0">
                                    <i class="fas fa-exclamation-circle me-2"></i>
                                    <strong>Advertencia:</strong> Hay <%= queue.count %> emails
                                        pendientes en la cola.
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                    <form action="/logs/retry-queue" method="POST" class="d-inline">
                                        <button type="submit" class="btn btn-warning btn-sm">
                                            <i class="fas fa-redo me-1"></i> Reintentar Envío
                                        </button>
                                    </form>
                                    <form action="/logs/flush-deferred" method="POST" class="d-inline">
                                        <button type="submit" class="btn btn-info btn-sm"
                                            onclick="return confirm('¿Limpiar solo correos diferidos?')">
                                            <i class="fas fa-trash-restore me-1"></i> Limpiar Diferidos
                                        </button>
                                    </form>
                                    <form action="/logs/flush-queue" method="POST" class="d-inline">
                                        <button type="submit" class="btn btn-danger btn-sm"
                                            onclick="return confirm('¿ESTÁS SEGURO? Esto eliminará TODOS los emails en cola permanentemente.')">
                                            <i class="fas fa-trash me-1"></i> Limpiar Todo
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Estadísticas por Dominio -->
                        <% if (queue.byDomain && queue.byDomain.trim() !=='' ) { %>
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h6 class="mb-0">
                                                <i class="fas fa-chart-pie me-2"></i>Distribución por
                                                Dominio
                                            </h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <% const domainLines=queue.byDomain.split('\n').filter(line=>
                                                    line.trim() !== ''); %>
                                                    <% domainLines.forEach(domainLine=> { %>
                                                        <% const [count, domain]=domainLine.trim().split(/\s+/); %>
                                                            <% if (count && domain) { %>
                                                                <div class="col-auto mb-2">
                                                                    <span class="badge bg-primary domain-badge">
                                                                        <%= domain %>: <strong>
                                                                                <%= count %>
                                                                            </strong>
                                                                    </span>
                                                                </div>
                                                                <% } %>
                                                                    <% }); %>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% } %>

                                <!-- Detalles de la Cola -->
                                <div class="row">
                                    <div class="col-12">
                                        <div class="card">
                                            <div class="card-header d-flex justify-content-between align-items-center">
                                                <h6 class="mb-0">
                                                    <i class="fas fa-list me-2"></i>Detalles de la Cola
                                                </h6>
                                                <small class="text-muted">Mostrando contenido completo
                                                    de mailq</small>
                                            </div>
                                            <div class="card-body p-0">
                                                <pre class="queue-item p-3 mb-0 email-scroll"><%= queue.details %></pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <% } else { %>
                                    <!-- Cola Vacía -->
                                    <div class="text-center py-5">
                                        <div class="text-success mb-3">
                                            <i class="fas fa-check-circle fa-4x"></i>
                                        </div>
                                        <h3 class="text-success">Cola de Correo Vacía</h3>
                                        <p class="text-muted mb-4">No hay emails pendientes en la cola
                                            de Postfix</p>
                                        <div class="d-flex justify-content-center gap-3">
                                            <a href="/logs/statistics" class="btn btn-primary">
                                                <i class="fas fa-chart-bar me-2"></i>Volver a
                                                Estadísticas
                                            </a>
                                            <form action="/logs/queue" method="GET" class="d-inline">
                                                <button type="submit" class="btn btn-outline-secondary">
                                                    <i class="fas fa-sync-alt me-2"></i>Actualizar
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                    <% } %>
                </div>
                <div class="card-footer text-muted d-flex justify-content-between align-items-center">
                    <div>
                        <i class="fas fa-clock me-1"></i>
                        Última actualización: <strong>
                            <%= queue.timestamp %>
                        </strong>
                    </div>
                    <div>
                        <form action="/logs/queue" method="GET" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-sync-alt me-1"></i>Actualizar
                            </button>
                        </form>
                        <a href="/logs/statistics" class="btn btn-sm btn-outline-secondary ms-1">
                            <i class="fas fa-arrow-left me-1"></i>Estadísticas
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Auto-scroll to top when page loads
    document.addEventListener('DOMContentLoaded', function () {
        window.scrollTo(0, 0);

            // Auto-refresh every 30 seconds if there are emails in queue
            <% if (queue.count > 0) { %>
            setTimeout(function () {
                window.location.reload();
            }, 30000);
            <% } %>
        });

    // Confirmación para acciones destructivas
    document.addEventListener('DOMContentLoaded', function () {
        const dangerousButtons = document.querySelectorAll('button[onclick*="confirm"]');
        dangerousButtons.forEach(button => {
            button.addEventListener('click', function (e) {
                if (!confirm(this.getAttribute('onclick').match(/'([^']+)'/)[1])) {
                    e.preventDefault();
                }
            });
        });
    });
</script>