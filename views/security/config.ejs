<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Configuración de Seguridad</h1>
</div>

<% if (errors && errors.length> 0) { %>
    <div class="alert alert-danger">
        <ul class="mb-0">
            <% errors.forEach(error=> { %>
                <li>
                    <%= error %>
                </li>
                <% }) %>
        </ul>
    </div>
    <% } %>

        <ul class="nav nav-tabs" id="securityTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="antivirus-tab" data-bs-toggle="tab" data-bs-target="#antivirus"
                    type="button" role="tab">Antivirus</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="ssl-tab" data-bs-toggle="tab" data-bs-target="#ssl" type="button"
                    role="tab">SSL/TLS</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="certificate-tab" data-bs-toggle="tab" data-bs-target="#certificate"
                    type="button" role="tab">Certificado</button>
            </li>
        </ul>

        <div class="tab-content p-3 border border-top-0 rounded-bottom" id="securityTabsContent">
            <!-- Pestaña de Antivirus -->
            <div class="tab-pane fade show active" id="antivirus" role="tabpanel">
                <form method="POST" action="/security">
                    <input type="hidden" name="tab" value="antivirus">

                    <div class="mb-3">
                        <label for="antivirusConfig" class="form-label">Configuración de Antivirus</label>
                        <textarea class="form-control" id="antivirusConfig" name="antivirusConfig" rows="10"
                            required><%= antivirusConfig || '' %></textarea>
                        <div class="form-text">Configuración del antivirus para escaneo de correo</div>
                    </div>

                    <button type="submit" class="btn btn-primary">Guardar Configuración</button>
                </form>
            </div>

            <!-- Pestaña de SSL/TLS -->
            <div class="tab-pane fade" id="ssl" role="tabpanel">
                <form method="POST" action="/security">
                    <input type="hidden" name="tab" value="ssl">

                    <div class="mb-3">
                        <label for="sslConfig" class="form-label">Configuración SSL/TLS</label>
                        <textarea class="form-control" id="sslConfig" name="sslConfig" rows="10"
                            required><%= sslConfig || '' %></textarea>
                        <div class="form-text">Configuración de SSL/TLS para los servicios de correo</div>
                    </div>

                    <button type="submit" class="btn btn-primary">Guardar Configuración</button>
                </form>
            </div>

            <!-- Pestaña de Certificado -->
            <div class="tab-pane fade" id="certificate" role="tabpanel">
                <form method="POST" action="/security/upload-certificate" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="certificate" class="form-label">Certificado SSL (.crt/.pem)</label>
                        <input type="file" class="form-control" id="certificate" name="certificate" accept=".crt,.pem">
                    </div>

                    <div class="mb-3">
                        <label for="privateKey" class="form-label">Clave Privada (.key)</label>
                        <input type="file" class="form-control" id="privateKey" name="privateKey" accept=".key">
                    </div>

                    <div class="mb-3">
                        <div class="form-text">
                            Suba ambos archivos: el certificado y la clave privada.
                            El certificado debe estar en formato PEM.
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">Subir Certificado</button>
                </form>

                <% if (certificateInfo) { %>
                    <div class="mt-4">
                        <h5>Información del Certificado Actual</h5>
                        <div class="card">
                            <div class="card-body">
                                <p><strong>Emisor:</strong>
                                    <%= certificateInfo.issuer %>
                                </p>
                                <p><strong>Sujeto:</strong>
                                    <%= certificateInfo.subject %>
                                </p>
                                <p><strong>Válido desde:</strong>
                                    <%= certificateInfo.validFrom %>
                                </p>
                                <p><strong>Válido hasta:</strong>
                                    <%= certificateInfo.validTo %>
                                </p>
                                <p><strong>Días restantes:</strong>
                                    <%= certificateInfo.daysRemaining %>
                                </p>
                            </div>
                        </div>
                    </div>
                    <% } %>
            </div>
        </div>